<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="paquet">
<title>File Stream Workflow • paquet</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="File Stream Workflow">
<meta property="og:description" content="paquet">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">paquet</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/file-stream.html">File Stream Workflow</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/metrumresearchgroup/paquet/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>File Stream Workflow</h1>
                        <h4 data-toc-skip class="author"></h4>
            
            <h4 data-toc-skip class="date">2022-04-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/metrumresearchgroup/paquet/blob/HEAD/vignettes/file-stream.Rmd" class="external-link"><code>vignettes/file-stream.Rmd</code></a></small>
      <div class="d-none name"><code>file-stream.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>File streams are objects you can create to help in organizing larger simulations which are naturally broken in to a series of smaller simulations. One example is a set of replicate simulations which are performed as a part of simulation-based model checking. Another example would be a large number of doses which need to be evaluated in a population context. In this case, one <em>very</em> large data set is assembled and then broken into <code>chunks</code> to be simulated in parallel. In both cases, it is assumed that the outputs (and maybe the inputs) are very large and would benefit from an extra layer of organization, including a consideration of how the simulations are stored on disk and accessed at a later time.</p>
<p>The emphasis in these use cases is better management of very large simulation outputs. However, given this is a package vignette, we will illustrate the setup and implementation with problems of a (much) smaller scale.</p>
</div>
<div class="section level2">
<h2 id="file-stream-basics">File stream basics<a class="anchor" aria-label="anchor" href="#file-stream-basics"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/metrumresearchgroup/paquet" class="external-link">paquet</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/metrumresearchgroup/mrgsolve" class="external-link">mrgsolve</a></span><span class="op">)</span></code></pre></div>
<p>In the simplest use case, we might want to simulate some large number of replicates. We can start to manage this simulation by creating a file stream</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_stream.html">new_stream</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></code></pre></div>
<p>This creates a file stream, which is just a list with one position representing each replicate that we want to do</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<pre><code>. [1] 10</code></pre>
<p>Each slot holds another list containing information for the <code>ith</code> replicate. Looking at replicate 5 we have</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<pre><code>. $i
. [1] 5
. 
. $file
. [1] "05-10"
. 
. $x
. [1] 5
. 
. attr(,"file_set_item")
. [1] TRUE</code></pre>
<p>There are three named positions</p>
<ol style="list-style-type: decimal">
<li>
<code>i</code> the replicate number</li>
<li>
<code>file</code> the stem of the output file for this replicate</li>
<li>
<code>x</code> the data payload for this replicate; in this case it is just <code>i</code>
</li>
</ol>
<p>The stem of the output file is named with the current replicate number (<code>05</code>) and the total number of replicates in the set (<code>10</code>). The file stem will always be configured to have the format <code>n</code> of <code>N</code>; but can be customized with a prefix or to use a different separator character (see below).</p>
<p>If we had a model and data set to be simulated in replicate</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mrgsolve/man/house.html" class="external-link">house</a></span><span class="op">(</span>rtol <span class="op">=</span> <span class="fl">1e-4</span>, outvars <span class="op">=</span> <span class="st">"DV"</span><span class="op">)</span>

<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mrgsolve/man/expand.idata.html" class="external-link">expand.ev</a></span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span>, ID <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></code></pre></div>
<p>we could use the file stream object to structure the simulation</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">x</span>, <span class="kw">function</span><span class="op">(</span><span class="va">fs</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/mrgsolve/man/mrgsim.html" class="external-link">mrgsim</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>i <span class="op">=</span> <span class="va">fs</span><span class="op">$</span><span class="va">i</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>We have used the replicate number (<code>fs$i</code>) to tag the output of the simulation. This is a simple example to get started on the basic idea. We could have easily done the same simulation by calling</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/mrgsolve/man/mrgsim.html" class="external-link">mrgsim</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>i <span class="op">=</span> <span class="va">i</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>It would give identical results and using the file stream would have been overkill. So let’s use the file stream object to help us save these simulations to a file in an efficient and organized way.</p>
</div>
<div class="section level2">
<h2 id="use-file-stream-to-create-a-data-set-on-disk">Use file stream to create a data set on disk<a class="anchor" aria-label="anchor" href="#use-file-stream-to-create-a-data-set-on-disk"></a>
</h2>
<p>To do this we’ll add two arguments to the call to <code><a href="../reference/new_stream.html">new_stream()</a></code></p>
<ol style="list-style-type: decimal">
<li>
<code>locker</code> a directory that is reserved for this set of simulation output (only)</li>
<li>
<code>format</code> the output format for saving the files</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">locker</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"replicate1"</span><span class="op">)</span>

<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_stream.html">new_stream</a></span><span class="op">(</span><span class="fl">10</span>, locker <span class="op">=</span> <span class="va">locker</span>, format <span class="op">=</span> <span class="st">"fst"</span><span class="op">)</span></code></pre></div>
<p>Since this is a package vignette, we are saving the outputs to <code><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir()</a></code>, not something that we’d recommend in production work, where simulations should be saved locally. We also specified <code>format</code> to be <code>fst</code>, which uses the package of the same name to save the data in an efficient format.</p>
<p>Now let’s look at the object for the 5th replicate</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<pre><code>. $i
. [1] 5
. 
. $file
. [1] "/var/folders/5w/2ky5lwcj1zq7kyk4c3zg3zpw0000gp/T//RtmpOkOqSo/replicate1/05-10.fst"
. 
. $x
. [1] 5
. 
. attr(,"file_set_item")
. [1] TRUE
. attr(,"class")
. [1] "stream_format_fst" "list"</code></pre>
<p>We still have <code>i</code> (the replicate number). But now <code>file</code> is populated with a complete path to the output file. What can’t be seen here is that the <code>replicate</code> directory has been created</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">file</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>. [1] TRUE</code></pre>
<p>When the file stream was created, so was the directory where the files would be saved. Details about the storage <code>locker</code> are provided below.</p>
<p>Also notice that the object has a new attribute</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>. [1] "stream_format_fst" "list"</code></pre>
<p>This indicates that the file</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">file</span><span class="op">)</span></code></pre></div>
<pre><code>. [1] "05-10.fst"</code></pre>
<p>will be saved in <code>fst</code> format when the time comes. <code>fst</code> a very efficient format for storing data frames in R; but you can choose other formats, like <code>feather</code> (also for data frames) or <code>qs</code> or <code>rds</code> for saving any R object.</p>
<p>To save the <code>ith</code> replicate to its pre-defined file location, we call the function <code><a href="../reference/write_stream.html">write_stream()</a></code> inside our simulation loop</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">x</span>, <span class="kw">function</span><span class="op">(</span><span class="va">fs</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">ans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mrgsolve/man/mrgsim.html" class="external-link">mrgsim</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>i <span class="op">=</span> <span class="va">fs</span><span class="op">$</span><span class="va">i</span><span class="op">)</span>
  <span class="fu"><a href="../reference/write_stream.html">write_stream</a></span><span class="op">(</span><span class="va">fs</span>, <span class="va">ans</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">fs</span><span class="op">$</span><span class="va">file</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p>Notice in the previous that we didn’t return the data; that’s part of the strategy where we write the data to disk rather than return a potentially massive amount of data that could easily swamp our R session. But we did return the <code>location</code> of each file that we wrote out</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></code></pre></div>
<pre><code>. [[1]]
. [1] "/var/folders/5w/2ky5lwcj1zq7kyk4c3zg3zpw0000gp/T//RtmpOkOqSo/replicate1/01-10.fst"
. 
. [[2]]
. [1] "/var/folders/5w/2ky5lwcj1zq7kyk4c3zg3zpw0000gp/T//RtmpOkOqSo/replicate1/02-10.fst"
. 
. [[3]]
. [1] "/var/folders/5w/2ky5lwcj1zq7kyk4c3zg3zpw0000gp/T//RtmpOkOqSo/replicate1/03-10.fst"</code></pre>
<p>This makes it easy to read the data back in</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.fstpackage.org" class="external-link">fst</a></span><span class="op">)</span>
<span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">out</span>, <span class="va">read_fst</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sims</span><span class="op">[[</span><span class="fl">8</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p><code>paquet</code> provides a helper function for reading in a set of <code>fst</code> files</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/internalize_fst.html">internalize_fst</a></span><span class="op">(</span><span class="va">locker</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></code></pre></div>
<p>By default, <code>internalize_fst</code> returns a single data frame with all of your simulations. You can also run a head of the file set</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/head_fst.html">head_fst</a></span><span class="op">(</span><span class="va">locker</span>, n <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></code></pre></div>
<pre><code>.   ID time       DV i
. 1  1 0.00 0.000000 1
. 2  1 0.00 0.000000 1
. 3  1 0.25 1.287443 1
. 4  1 0.50 2.225213 1
. 5  1 0.75 2.904149 1
. 6  1 1.00 3.391513 1
. 7  1 1.25 3.737158 1
. 8  1 1.50 3.978021 1</code></pre>
<p>Or get a list of the files</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fst</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/list_fst.html">list_fst</a></span><span class="op">(</span><span class="va">locker</span><span class="op">)</span>
<span class="va">fst</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></code></pre></div>
<pre><code>. [1] "/var/folders/5w/2ky5lwcj1zq7kyk4c3zg3zpw0000gp/T//RtmpOkOqSo/replicate1/02-10.fst"</code></pre>
</div>
<div class="section level2">
<h2 id="alternate-better-file-formats">Alternate (better) file formats<a class="anchor" aria-label="anchor" href="#alternate-better-file-formats"></a>
</h2>
<p><code>fst</code> is an excellent file format and very fast to read and write. But notice with the <code><a href="../reference/internalize_fst.html">internalize_fst()</a></code> call, we are still reading in all the data back into the R session. We don’t <em>have</em> to do that; we could have just read the first 5 files</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/list_fst.html">list_fst</a></span><span class="op">(</span><span class="va">locker</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">read_fst</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>But we want better value for the price that was paid to write the outputs to disk.</p>
<p>This is where the <code>arrow</code> package comes in. Apache Arrow is “a cross-language development platform for in-memory data.” Basically, you can have a huge amount of data on disk in an arrow data set and work with it as if it is loaded in memory.</p>
<p>The following examples will only be run if the arrow package is installed when this vignette is built.</p>
<p>First, re-create the file stream with format <code>feather</code></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_stream.html">new_stream</a></span><span class="op">(</span><span class="fl">10</span>, format <span class="op">=</span> <span class="st">"feather"</span>, locker <span class="op">=</span> <span class="va">locker</span><span class="op">)</span></code></pre></div>
<p>Now, the files are ready to be stored in feather format</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">file</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>and when we re-run the simulation, we’ll have a set of <code>feather</code> files rather than <code>fst</code> files</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">x</span>, <span class="kw">function</span><span class="op">(</span><span class="va">fs</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">ans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mrgsolve/man/mrgsim.html" class="external-link">mrgsim</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>i <span class="op">=</span> <span class="va">fs</span><span class="op">$</span><span class="va">i</span><span class="op">)</span>
  <span class="fu"><a href="../reference/write_stream.html">write_stream</a></span><span class="op">(</span><span class="va">fs</span>, <span class="va">ans</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">fs</span><span class="op">$</span><span class="va">file</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p>Notice that there is no change to the simulation code; we still call <code><a href="../reference/write_stream.html">write_stream()</a></code> and because <code>fs[[i]]</code> is set up with <code>feather</code> output, we get that method when writing.</p>
<p>Now we don’t need a helper function to read the files; we’ll use <code>arrow::open_dataset()</code></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/apache/arrow/" class="external-link">arrow</a></span><span class="op">)</span>

<span class="va">ds</span> <span class="op">&lt;-</span> <span class="fu">arrow</span><span class="fu">::</span><span class="fu">open_dataset</span><span class="op">(</span><span class="va">locker</span>, format <span class="op">=</span> <span class="st">"feather"</span><span class="op">)</span></code></pre></div>
<p>This <code>ds</code> object is a pointer to the data; it hasn’t actually been loaded but we can take a peek at it</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ds</span><span class="op">)</span></code></pre></div>
<p>Once we have the data set open, we can <code>filter</code> and <code>select</code> the rows and columns that we want, and then call <code><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble()</a></code> to collect the results</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ds</span>, <span class="va">time</span> <span class="op">&gt;</span> <span class="fl">12</span>, <span class="va">i</span> <span class="op">&lt;</span> <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Now we have only the part of the simulated data that we need to work with right now</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="manipulating-file-streams">Manipulating file streams<a class="anchor" aria-label="anchor" href="#manipulating-file-streams"></a>
</h2>
<p>In the most basic example, we created a file stream like this</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_stream.html">new_stream</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></code></pre></div>
<p>Once the file stream is created, we can indicate the output format after the fact</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/format_stream.html">format_stream</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"fst"</span><span class="op">)</span></code></pre></div>
<p>This will put the proper class on the <code>file_stream</code> object and set the file extension</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">file</span></code></pre></div>
<pre><code>. [1] "03-10.fst"</code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>. [1] "stream_format_fst" "list"</code></pre>
<p>There are also functions for adding an output file path</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/locate_stream.html">locate_stream</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">locker</span><span class="op">)</span>
<span class="va">x</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">file</span></code></pre></div>
<pre><code>. [1] "/var/folders/5w/2ky5lwcj1zq7kyk4c3zg3zpw0000gp/T//RtmpOkOqSo/replicate1/02-10.fst"</code></pre>
<p><code><a href="../reference/locate_stream.html">locate_stream()</a></code> comes with an argument called <code>initialize</code> which can be used to initialize the locker space if it hasn’t already been initialized or reset.</p>
<p>Finally, you can manipulate the file extension</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ext_stream.html">ext_stream</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">""</span><span class="op">)</span>
<span class="va">x</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">file</span></code></pre></div>
<pre><code>. [1] "/var/folders/5w/2ky5lwcj1zq7kyk4c3zg3zpw0000gp/T//RtmpOkOqSo/replicate1/04-10"</code></pre>
<p>Here we just removed the file extension. If you are adding a file extension, be sure to include the dot <code>(.)</code>.</p>
</div>
<div class="section level2">
<h2 id="pass-objects-via-file-stream">Pass objects via file stream<a class="anchor" aria-label="anchor" href="#pass-objects-via-file-stream"></a>
</h2>
<p>In the simple example, we just numbered each spot in the file stream object. Passing a single number will create a sequence of that length</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_stream.html">new_stream</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></code></pre></div>
<p>Otherwise, we can create a custom sequence</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_stream.html">new_stream</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="va">x</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<pre><code>. $i
. [1] 2
. 
. $file
. [1] "02-25"
. 
. $x
. [1] 5
. 
. attr(,"file_set_item")
. [1] TRUE</code></pre>
<p>If we have a large data set, we can chunk that up and pass that in. Illustrating with a toy example</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mrgsolve/man/expand.idata.html" class="external-link">expand.ev</a></span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span>, ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></code></pre></div>
<pre><code>.   ID time amt cmt evid
. 1  1    0 100   1    1
. 2  2    0 100   1    1
. 3  3    0 100   1    1
. 4  4    0 100   1    1
. 5  5    0 100   1    1
. 6  6    0 100   1    1</code></pre>
<p>chunk the data frame into a list</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">chunked</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chunk_data_frame.html">chunk_by_row</a></span><span class="op">(</span><span class="va">data</span>, nchunk <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<p>And then pass that in</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_stream.html">new_stream</a></span><span class="op">(</span><span class="va">chunked</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<pre><code>. [1] 5</code></pre>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<pre><code>. $i
. [1] 3
. 
. $file
. [1] "3-5"
. 
. $x
.   ID time amt cmt evid
. 5  5    0 100   1    1
. 6  6    0 100   1    1
. 
. attr(,"file_set_item")
. [1] TRUE</code></pre>
<p>Now he <code>x</code> position has only the “chunk” of data that we need for the current simulation; this prevents the entire data frame from getting passed to every worker.</p>
</div>
<div class="section level2">
<h2 id="the-locker-system">The locker system<a class="anchor" aria-label="anchor" href="#the-locker-system"></a>
</h2>
<p>There are important things to know about the locker system; this is what really makes the arrow data sets work well.</p>
<p>When you first create a file stream with a <code>locker</code> location, you need to specify a directory that does not exist; if the directory exists, you’ll get an error.</p>
<p>Once you create a locker space, that space is reserved for storing output files and should <strong>only</strong> be used for storing files that are saved using <code><a href="../reference/write_stream.html">write_stream()</a></code>. The locker space is marked by a hidden file that tells <code>paquet</code> that this is a locker space</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_stream.html">new_stream</a></span><span class="op">(</span><span class="fl">3</span>, locker <span class="op">=</span> <span class="va">locker</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">locker</span>, all.files <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>. [1] "."                  ".."                 ".paquet-locker-dir"</code></pre>
<p>Because this is a marked and reserved space, whenever the file stream is initiated, the locker space is <strong>completely</strong> cleared of files. That is to say, all the files in the locker space will be blown away at the time the file stream is created or re-created. To say it another way, <code><a href="../reference/new_stream.html">new_stream()</a></code> called with a locker creates the locker space the first time it is called and <strong>completely clears the space</strong> at any subsequent call with that locker name. This is really important to remember that the process renews / resets at the time that <code><a href="../reference/new_stream.html">new_stream()</a></code> is called; it is equivalent to over writing existing files except that it happens in two steps: first all existing files are removed and then new files are created. Thus, the locker world works mainly in terms of directories rather than files (although obviously files are also involved).</p>
<p><strong>WHY?</strong> The reason for this is to be able to support arrow data sets. Using <code>arrow::open_dataset(lockername)</code> is a very efficient way to access very large data stored on disk. In order for this to work, all of the files in the directory must be contributing members of that data set. The only way to do this is to reset the data set space whenever the data set is re-written and that happens at the time the file set is created.</p>
<div class="section level3">
<h3 id="safety-considerations">Safety considerations<a class="anchor" aria-label="anchor" href="#safety-considerations"></a>
</h3>
<p>Note that <code>locker</code> is meant to be a folder on your disk that is resettable. The say way you can call <code>write.csv("my-data.csv")</code> when <code>my-data.csv</code> already exists, we expect that calling <code>new_stream(..., locker = "foo/bar")</code> will (eventually) overwrite the files in <code>foo/bar</code>. There is really no difference except that we must clear out the <code>locker</code> prior to writing the files.</p>
<p>That said, we understand that lockers can store very large files that are expensive to generate. So, we have given the user several options to safeguard the locker space the next time paquet tries to reset the the space. This is equivalent to calling</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="st">"my-data.csv"</span><span class="op">)</span></code></pre></div>
<p>and getting an error or asking for confirmation if <code>my-data.csv</code> exists. The user is encouraged to understand how <code><a href="../reference/new_stream.html">new_stream()</a></code> works and how to effectively use the safeguards outlined here. Only you can properly safeguard the data; we give you the tools and it is up to you to use them. If you do choose to use these tools, you are responsible for all intended and un-intended consequences. The safety tools are only in place to prevent accidental removal of files in the locker space and there is no guarantee that the locker space will at any point only contain the files that you intended to retain; you own that responsibility when you opt in to these tools.</p>
<p>Several approaches are available to secure future or existing files which may be stored in locker space:</p>
<ol style="list-style-type: decimal">
<li>
<code>ask</code>: set up locker space so that you are asked every time a locker reset is requested</li>
<li>
<code>noreset</code>: make the locker non-resettable; this can be done at the time the locker space is created or after the fact</li>
<li>
<code>version</code>: create a versioned back up of existing simulations</li>
</ol>
<div class="section level4">
<h4 id="ask">Ask<a class="anchor" aria-label="anchor" href="#ask"></a>
</h4>
<p>This code is not executed, but provided as example for you. To require user confirmation for locker reset, pass <code>ask = TRUE</code> when creating a new file stream</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_stream.html">new_stream</a></span><span class="op">(</span><span class="fl">100</span>, locker <span class="op">=</span> <span class="st">"foo/bar"</span>, ask <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>This command creates a locker space in <code>foo/bar</code> and marks that directory so that every time you try to reset the locker space (clear the output files), you will be prompted to confirm the reset using <code><a href="https://rdrr.io/r/utils/askYesNo.html" class="external-link">utils::askYesNo</a></code>.</p>
<p>You can also convert an existing locker space so that you are asked every time locker reset is attempted using</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/config_locker.html">config_locker</a></span><span class="op">(</span><span class="st">"foo/bar"</span>, ask <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>You can remove the ask requirement with</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/config_locker.html">config_locker</a></span><span class="op">(</span><span class="st">"foo/bar"</span>, ask <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Please read and understand the documentation for <code>setup_locker</code>; if anything is not clear, please ask.</p>
</div>
<div class="section level4">
<h4 id="no-reset">No Reset<a class="anchor" aria-label="anchor" href="#no-reset"></a>
</h4>
<p>You can mark a locker space un-resettable. This can be done when a file stream is created</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_stream.html">new_stream</a></span><span class="op">(</span><span class="fl">100</span>, locker <span class="op">=</span> <span class="st">"foo/bar"</span>, noreset <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>This command creates locker space and immediately revokes the ability to reset the space. You can also take an existing locker space and revoke with</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/config_locker.html">config_locker</a></span><span class="op">(</span><span class="st">"foo/bar"</span>, noreset <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>One this is called, the space can no longer be reset. To restore reset-ability:</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/config_locker.html">config_locker</a></span><span class="op">(</span><span class="st">"foo/bar"</span>, noreset <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="versions">Versions<a class="anchor" aria-label="anchor" href="#versions"></a>
</h4>
<p>To save a version of some simulations, call <code><a href="../reference/version_locker.html">version_locker()</a></code></p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/version_locker.html">version_locker</a></span><span class="op">(</span><span class="va">locker</span>, version <span class="op">=</span> <span class="st">"v000"</span><span class="op">)</span></code></pre></div>
<p>This creates a new directory named according to the existing locker name, but with a “version” tag attached, and copies all the locker files to this new directory.</p>
<p>See the help topic <code><a href="../reference/version_locker.html">?version_locker</a></code> for more options around this versioning process. New versions are not automatically incremented (e.g. “locker-001”, “locker-002”) by design. The intent behind the locker system is to create a re-writable space. Versioning an existing locker is just a convenient way to stash existing simulations under a similar name. Note that you can also create a new version at your call to <code><a href="../reference/new_stream.html">new_stream()</a></code></p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_stream.html">new_stream</a></span><span class="op">(</span><span class="fl">100</span>, locker <span class="op">=</span> <span class="st">"existing/locker-v2"</span><span class="op">)</span></code></pre></div>
<p>Going forward, simulations will be saved to “version 2” of a locker location that already exists. There is nothing special about this setup; just some creativity in naming output directories.</p>
<p>Caution is advised: the locker system was created to save very large simulation outputs; by continuously creating new versions, you could quickly overrun your disk space. This should be used with care.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Kyle T Baron.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
